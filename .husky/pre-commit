#!/usr/bin/env bash
set -euo pipefail

# Rebuild ONLY if whoami.md is staged
if git diff --name-only --cached | grep -q '^whoami/whoami\.md$'; then
  echo "[husky] rebuilding whoami because whoami.md changed…"

  NODE="/home/linuxbrew/.linuxbrew/bin/node"
  if command -v flatpak-spawn >/dev/null 2>&1; then
    flatpak-spawn --host "$NODE" whoami/build.js
  else
    "$NODE" whoami/build.js
  fi

  git add whoami/index.html
  echo "[husky] whoami/index.html staged ✔"
else
  echo "[husky] skip rebuild (whoami.md not staged)"
fi
